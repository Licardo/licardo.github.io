<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Flutter Boost 1 | Paofan&amp;Orange</title>
  <meta name="description" content="welcome" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/component.css" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <meta name="generator" content="Paofan&Orange">
  <script src="http://static.duoshuo.com/embed.js"></script>
  
  
  

  

</head>
<body>
<div class="container">
    <div class="mp-pusher" id="mp-pusher">
        <i id="scroll-up" class="fa fa-angle-up"></i>
        <nav id="mp-menu" class="mp-menu">
            <div class="mp-level">
                <a data-pjax class="back-home" style="font-size: 20px" href="/"><h2 ><i class="fa fa-home"></i>
                        Home</h2></a>
                <ul class="first-level">
                    <li>
                        <a class="fa fa-archive" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Archive</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-archive"></i>
                                Archive</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-archive" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2021/05/09/Flutter总结/">Flutter总结</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2021/05/06/Flutter_Boost/">Flutter Boost 1</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2021/04/13/Gradle_Plugin_Shrink_Image/">Gradle插件-图片</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2021/04/12/auto_install_module/">自动化装卸载Module功能</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2021/04/12/batch_auto_package_aar/">批量自动化打AAR包功能</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2021/04/09/png-structure/">png structure</a>
                                </li>
                                
                                <li class="search-archive-li mp-pjax">
                                    <a href="/2021/04/08/hello-world/">Hello World</a>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-copy" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Categories</a>

                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-copy"></i>
                                Categories</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-category" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    <li>
                        <a class="fa fa-tags" href="#"><i class="fa fa-angle-left">
                            </i>&nbsp;&nbsp;Tags</a>
                        <div class="mp-level page-list">
                            <h2 ><i class="fa fa-tags"></i>
                                Tags</h2>
                            <a class="mp-back" href="#">back</a>
                            <form id="search-form" action="">
                                <input type="text" class="search search-tag" placeholder="Search.."/>
                            </form>
                            <ul>
                                <div class="mp-scroll">
                                
                                <li class="search-tag-li mp-pjax">
                                    <a href="/tags/flutter/">&nbsp;&nbsp;&nbsp;flutter</a>
                                    <small>2</small>
                                </li>
                                
                                </div>
                            </ul>
                        </div>
                    </li>
                    
                    <li class="mp-pjax"><a class="fa fa-user" href="/about">&nbsp;&nbsp;&nbsp;About me</a></li>
                    <li><a class="fa fa-github" href="#">&nbsp;&nbsp;&nbsp;Github</a></li>

                </ul>

            </div>
        </nav>
        <div id="pjax">
            <div class="pjax-hidden" style="display: none">
                
                    <a  data-pjax href="/2021/05/09/Flutter总结/">Flutter总结</a>
                
                    <a  data-pjax href="/2021/05/06/Flutter_Boost/">Flutter Boost 1</a>
                
                    <a  data-pjax href="/2021/04/13/Gradle_Plugin_Shrink_Image/">Gradle插件-图片</a>
                
                    <a  data-pjax href="/2021/04/12/auto_install_module/">自动化装卸载Module功能</a>
                
                    <a  data-pjax href="/2021/04/12/batch_auto_package_aar/">批量自动化打AAR包功能</a>
                
                    <a  data-pjax href="/2021/04/09/png-structure/">png structure</a>
                
                    <a  data-pjax href="/2021/04/08/hello-world/">Hello World</a>
                
                
                
                    <a data-pjax href="/tags/flutter/">&nbsp;&nbsp;flutter</a>
                
                <a data-pjax class="fa fa-user" href="/about">&nbsp;&nbsp;&nbsp;About me</a>
            </div>
            <nav class="nexus">
                <li  style="border-left: 1px solid #c6d0da;">
                    <a id="trigger" href="#"><i class="fa fa-bars"></i></a>
                </li>
                <li ><a id="nexus-back" data-pjax href="/">Paofan&amp;Orange</a></li>
                
                <div id="nav-container">
                    <div class="post-navbar" style="line-height: 63px;display:none">
                        <li id="navbar-title"><a href="#">Flutter Boost 1</a></li>
                        <li id="navbar-toc" style="border-left: none">
                            <a style="padding-right: 15px">
                                <span id="toc-content" >Introduction</span><i class="fa fa-chevron-down" ></i>
                            </a>
                            <div class="hidden-box">
                                <ul id="toc"></ul>
                            </div>
                        </li>
                    </div>
                </div>
                
            </nav>

            <div class="scroller">
            <div class="scroller-inner">


<!-- -->
<!--<body class="post-template">-->
<!---->
  

<main class="content" role="main">
    <article class="post" >
    <span class="post-meta">
                  <div class="tag-tile">
                      
                      
                      <a data-pjax href='/tags/flutter/' style='color:#D5D5D5'>flutter</a>
                      
                      
                  </div>
                <h1 class="post-title" style="margin: 14px 0;color:#50585D">Flutter Boost 1</h1>

                    <div class="post-meta">
                        Post on<span class="fa fa-clock-o"></span>
                        <time datetime="2021-05-06T11:30:00.000Z"
                              itemprop="datePublished">2021-05-06</time>
                    </div>
    </span>

        <section class="post-content">
            <h3 id="Flutter-Boost"><a href="#Flutter-Boost" class="headerlink" title="Flutter Boost"></a>Flutter Boost</h3><p>Flutter_Boost是闲鱼开源的Flutter框架，主要针对混合开发的项目，利于Flutter Engine共享方案实现混合栈管理</p>
<h4 id="Android项目集成"><a href="#Android项目集成" class="headerlink" title="Android项目集成"></a>Android项目集成</h4><p>本次调研是以Flutter Module的形式将Flutter集成到android项目，优势是无需改动项目原有结构，可以保证Android和Flutter单独开发没有强依赖，最终Flutter以aar的形式集成到项目中。</p>
<p><strong>集成步骤：</strong></p>
<ol>
<li><p>安装Flutter SDK，配置环境变量。以macOS为示例：</p>
<ol>
<li><p>下载Flutter SDK压缩包，<a target="_blank" rel="noopener" href="https://flutter.dev/docs/get-started/install">官方下载地址</a>，<a target="_blank" rel="noopener" href="https://github.com/flutter/flutter/releases">备用地址</a></p>
</li>
<li><p>```shell<br>cd flutter<br>unzip flutter_macos_vxxx-beta.zip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3. 配置环境变量</span><br><span class="line"></span><br><span class="line">   &#96;&#96;&#96;shell</span><br><span class="line">   vim ~&#x2F;bash_profile</span><br><span class="line">   export PATH&#x3D;$&#123;PATH&#125;:&#x2F;Users&#x2F;xxx&#x2F;flutter&#x2F;flutter&#x2F;bin</span><br></pre></td></tr></table></figure></li>
<li><p>shell运行命令：flutter doctor -v</p>
</li>
</ol>
</li>
<li><p>配置Android Studio环境和插件</p>
<ol>
<li>打开 Android Studio -&gt; Preferences -&gt; Languages &amp; Frameworks -&gt; Flutter，配置Flutter SDK path：/Users/xxx/flutter/flutter</li>
<li>打开Android Studio 插件下载中心，下载Dart和Flutter插件，重启Android Studio即可</li>
</ol>
</li>
</ol>
<p>到这一步Flutter已经安装成功，点击Android Studio的new Module选项即可创建Flutter Module</p>
<p><strong>创建Flutter Module有两种方式：</strong></p>
<ol>
<li>手动创建：flutter create -t module -i objc flutter_module，注意：如果flutter_module要支持androidx，需要增加androidx选项 </li>
<li>Android Studio创建，点击new module，选择Flutter Module即可</li>
</ol>
<p>本次调研以第二种方式创建，创建完成后Android Studio自动生成部分模板代码,如果第一种方式创建需要手动加入，如下：</p>
<ul>
<li><p>settings.gradle</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">include <span class="string">&#x27;:app&#x27;</span></span><br><span class="line">setBinding(<span class="keyword">new</span> Binding([<span class="attr">gradle:</span> <span class="built_in">this</span>]))</span><br><span class="line">evaluate(<span class="keyword">new</span> File(</span><br><span class="line">  settingsDir,</span><br><span class="line">  <span class="string">&#x27;../flutter_module/.android/include_flutter.groovy&#x27;</span></span><br><span class="line">))</span><br><span class="line">rootProject.name = <span class="string">&quot;Boost&quot;</span></span><br><span class="line"></span><br><span class="line">include <span class="string">&#x27;:flutter_module&#x27;</span></span><br><span class="line">project(<span class="string">&#x27;:flutter_module&#x27;</span>).projectDir = <span class="keyword">new</span> File(<span class="string">&#x27;../flutter_module&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>build.gradle</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation project(<span class="attr">path:</span> <span class="string">&#x27;:flutter&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>集成Flutter_Boost步骤：</strong></p>
<ol>
<li><p>在pubspec.yaml中加入flutter_boost依赖</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dev_dependencies:</span></span><br><span class="line">  <span class="attr">flutter_test:</span></span><br><span class="line">    <span class="attr">sdk:</span> <span class="string">flutter</span></span><br><span class="line">  <span class="attr">flutter_boost:</span></span><br><span class="line">    <span class="attr">git:</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">&#x27;https://github.com/alibaba/flutter_boost.git&#x27;</span></span><br><span class="line">      <span class="attr">ref:</span> <span class="string">&#x27;v3.0-beta.6&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p>点击右上角的Pub get按钮下载flutter_boost插件或shell执行：flutter packages get</p>
</li>
<li><p>在build.gradle文件增加依赖:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation project(<span class="attr">path:</span> <span class="string">&#x27;:flutter&#x27;</span>)</span><br><span class="line">implementation project(<span class="attr">path:</span> <span class="string">&#x27;:flutter_boost&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>Application中初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BoostApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        <span class="comment">// 初始化 Flutter_Boost</span></span><br><span class="line">        FlutterBoost.instance().setup(<span class="keyword">this</span>, <span class="keyword">new</span> FlutterBoostDelegate() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pushNativeRoute</span><span class="params">(String pageName, Map&lt;String, Object&gt; arguments)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Class target = Class.forName(pageName);</span><br><span class="line">                    Intent intent = <span class="keyword">new</span> Intent(FlutterBoost.instance().currentActivity(), target);</span><br><span class="line">                    FlutterBoost.instance().currentActivity().startActivity(intent);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                    Log.e(BoostApplication.class.getSimpleName(), e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pushFlutterRoute</span><span class="params">(String pageName, String uniqueId, Map&lt;String, Object&gt; arguments)</span> </span>&#123;</span><br><span class="line">                Intent intent = <span class="keyword">new</span> FlutterBoostActivity.CachedEngineIntentBuilder(FlutterBoostActivity.class, FlutterBoost.ENGINE_ID)</span><br><span class="line">                        .backgroundMode(FlutterActivityLaunchConfigs.BackgroundMode.opaque)</span><br><span class="line">                        .destroyEngineWithActivity(<span class="keyword">false</span>)</span><br><span class="line">                        .url(pageName)</span><br><span class="line">                        .urlParams(arguments)</span><br><span class="line">                        .build(FlutterBoost.instance().currentActivity());</span><br><span class="line">                FlutterBoost.instance().currentActivity().startActivity(intent);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, FlutterEngine::getPlugins);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在main.dart中初始化,注册flutter路由</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_MyHomePageState</span> <span class="keyword">extends</span> <span class="title">State</span>&lt;<span class="title">MyHomePage</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, FlutterBoostRouteFactory&gt;</span><br><span class="line">  routerMap = &#123;</span><br><span class="line">    <span class="string">&#x27;/&#x27;</span>: (settings, uniqueId) &#123;</span><br><span class="line">      <span class="keyword">return</span> PageRouteBuilder&lt;<span class="built_in">dynamic</span>&gt;(</span><br><span class="line">          settings: settings,</span><br><span class="line">          pageBuilder: (_, __, ___) =&gt;</span><br><span class="line">              Container()</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;welcome&#x27;</span>: (settings, uniqueId) &#123;</span><br><span class="line">      <span class="keyword">return</span> PageRouteBuilder&lt;<span class="built_in">dynamic</span>&gt;(</span><br><span class="line">          settings: settings,</span><br><span class="line">          pageBuilder: (_, __, ___) =&gt;</span><br><span class="line">              WelComeWidget()</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;login&#x27;</span>: (settings, uniqueId) &#123;</span><br><span class="line">      <span class="keyword">return</span> PageRouteBuilder&lt;<span class="built_in">dynamic</span>&gt;(</span><br><span class="line">          settings: settings,</span><br><span class="line">          pageBuilder: (_, __, ___,) =&gt;</span><br><span class="line">              LoginWidget()</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  Route&lt;<span class="built_in">dynamic</span>&gt; routeFactory(RouteSettings settings, <span class="built_in">String</span> uniqueId) &#123;</span><br><span class="line">    FlutterBoostRouteFactory func =routerMap[settings.name];</span><br><span class="line">    <span class="keyword">if</span> (func == <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> func(settings, uniqueId);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> initState() &#123;</span><br><span class="line">    <span class="keyword">super</span>.initState();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> FlutterBoostApp(</span><br><span class="line">        routeFactory</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Flutter-Boost栈管理"><a href="#Flutter-Boost栈管理" class="headerlink" title="Flutter_Boost栈管理"></a>Flutter_Boost栈管理</h4><p><img src="https://mmbiz.qpic.cn/mmbiz_png/DUwiayJ0Mj1Ep7pUwXRwhIGTyeXWrqUsKaibEs9JK28Aib1FrzRIhpEiaxiaXQ7x5wl2ejO5pqmMwVyICFktp2Zd8Jg/640?wx_fmt=png" alt="Flutter_Boost架构图"></p>
<p><strong>Flutter页面的创建过程：</strong></p>
<ol>
<li>创建Native容器（iOS ViewController，Android Activity or Fragment）。</li>
<li>Native容器通过消息机制通知Flutter Coordinator新的容器被创建。</li>
<li>Flutter Container Manager进而得到通知，负责创建出对应的Flutter容器，并且在其中装载对应的Widget页面。</li>
<li>当Native容器展示到屏幕上时，容器发消息给Flutter Coordinator通知要展示页面的id.</li>
<li>Flutter Container Manager找到对应id的Flutter Container并将其设置为前台可见容器。</li>
</ol>
<p>**Native to Flutter **</p>
<p>Native端的调用链：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 跳转api</span></span><br><span class="line">FlutterBoost.instance().open(<span class="string">&quot;welcome&quot;</span>, <span class="keyword">new</span> HashMap&lt;&gt;());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用Plugin </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(String name, Map&lt;String, Object&gt; arguments)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.getPlugin().getDelegate().pushFlutterRoute(name, <span class="keyword">null</span>, arguments);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化跳转方法</span></span><br><span class="line">FlutterBoost.instance().setup(<span class="keyword">this</span>, <span class="keyword">new</span> FlutterBoostDelegate() &#123;   </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pushFlutterRoute</span><span class="params">(String pageName, String uniqueId, Map&lt;String, Object&gt; arguments)</span> </span>&#123;</span><br><span class="line">    Intent intent = <span class="keyword">new</span> FlutterBoostActivity.CachedEngineIntentBuilder(FlutterBoostActivity.class, FlutterBoost.ENGINE_ID)</span><br><span class="line">      .backgroundMode(FlutterActivityLaunchConfigs.BackgroundMode.opaque)</span><br><span class="line">      .destroyEngineWithActivity(<span class="keyword">false</span>)</span><br><span class="line">      .url(pageName)</span><br><span class="line">      .urlParams(arguments)</span><br><span class="line">      .build(FlutterBoost.instance().currentActivity());</span><br><span class="line">    FlutterBoost.instance().currentActivity().startActivity(intent);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, FlutterEngine::getPlugins);</span><br><span class="line"></span><br><span class="line"><span class="comment">// FlutterBoost会监听所有Native容器的生命周期，用当前容器启动FlutterBoostActivity</span></span><br><span class="line"><span class="comment">// FlutterBoostActivity的可见回调onResume中发送Flutter通知</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">super</span>.onResume();</span><br><span class="line">  observer.onAppear(InitiatorLocation.Others);</span><br><span class="line">  ActivityAndFragmentPatch.onResumeAttachToFlutterEngine(flutterView, getFlutterEngine(),  <span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FlutterViewContainerObserver的onAppear方法</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAppear</span><span class="params">(InitiatorLocation location)</span> </span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  setBackForeGroundEvent(BackForeGroundEvent.NONE);</span><br><span class="line">  plugin.reorderContainer(getUniqueId(), <span class="keyword">this</span>);</span><br><span class="line">  plugin.pushRoute(getUniqueId(), getUrl(), getUrlParams(), <span class="keyword">null</span>);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// FlutterBoostPlugin的pushRoute方法</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pushRoute</span><span class="params">(String uniqueId, String pageName, Map&lt;String, Object&gt; arguments,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">final</span> Reply&lt;Void&gt; callback)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (channel != <span class="keyword">null</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">    channel.pushRoute(params, reply -&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (callback != <span class="keyword">null</span>) &#123;</span><br><span class="line">        callback.reply(<span class="keyword">null</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Messages的pushRoute方法 </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pushRoute</span><span class="params">(CommonParams argInput, Reply&lt;Void&gt; callback)</span> </span>&#123;</span><br><span class="line">  BasicMessageChannel&lt;Object&gt; channel =</span><br><span class="line">    <span class="keyword">new</span> BasicMessageChannel&lt;&gt;(binaryMessenger, <span class="string">&quot;dev.flutter.pigeon.FlutterRouterApi.pushRoute&quot;</span>, <span class="keyword">new</span> StandardMessageCodec());</span><br><span class="line">  Map&lt;String, Object&gt; inputMap = argInput.toMap();</span><br><span class="line">  channel.send(inputMap, channelReply -&gt; &#123;</span><br><span class="line">    callback.reply(<span class="keyword">null</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>**Flutter to Flutter **</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 跳转到imagepick页面，withContainer：是否需要新开Native容器</span></span><br><span class="line">BoostNavigator.of().push(<span class="string">&quot;imagepick&quot;</span>, withContainer: <span class="keyword">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="markdown">Push the page with the given [name] onto the hybrid stack.</span></span></span><br><span class="line">Future&lt;T&gt; push&lt;T <span class="keyword">extends</span> <span class="built_in">Object</span>&gt;(<span class="built_in">String</span> name,</span><br><span class="line">                                   &#123;<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; arguments, <span class="built_in">bool</span> withContainer = <span class="keyword">false</span>&#125;) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isFlutterPage(name)) &#123;</span><br><span class="line">    <span class="keyword">return</span> appState.pushWithResult(name,</span><br><span class="line">                                   arguments: arguments, withContainer: withContainer);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否需要新开Native容器</span></span><br><span class="line">Future&lt;T&gt; pushWithResult&lt;T <span class="keyword">extends</span> <span class="built_in">Object</span>&gt;(<span class="built_in">String</span> pageName,</span><br><span class="line">      &#123;<span class="built_in">String</span> uniqueId, <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; arguments, <span class="built_in">bool</span> withContainer&#125;) &#123;</span><br><span class="line">    uniqueId = _createUniqueId(pageName);</span><br><span class="line">    <span class="keyword">if</span> (withContainer) &#123;</span><br><span class="line">      ...</span><br><span class="line">      <span class="comment">// 通过channel调用Native的pushFlutterRoute方法</span></span><br><span class="line">      nativeRouterApi.pushFlutterRoute(params);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 在当前Native容器中打开Flutter页面</span></span><br><span class="line">      push(pageName,</span><br><span class="line">          uniqueId: uniqueId, arguments: arguments, withContainer: <span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    _pendingResult[uniqueId] = completer;</span><br><span class="line">    <span class="keyword">return</span> completer.future;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>**Flutter to Native **</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 跳转到Native页面</span></span><br><span class="line">BoostNavigator.of().push(<span class="string">&quot;native&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="markdown">Push the page with the given [name] onto the hybrid stack.</span></span></span><br><span class="line">Future&lt;T&gt; push&lt;T <span class="keyword">extends</span> <span class="built_in">Object</span>&gt;(<span class="built_in">String</span> name,</span><br><span class="line">                                   &#123;<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; arguments, <span class="built_in">bool</span> withContainer = <span class="keyword">false</span>&#125;) &#123;</span><br><span class="line">  <span class="keyword">if</span> (isFlutterPage(name)) &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">    appState.nativeRouterApi.pushNativeRoute(params);</span><br><span class="line">    <span class="keyword">return</span> appState.pendResult(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//跳转到Native页面</span></span><br><span class="line">Future&lt;<span class="keyword">void</span>&gt; pushNativeRoute(CommonParams arg) <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">Object</span> encoded = arg.encode();</span><br><span class="line">  <span class="keyword">const</span> BasicMessageChannel&lt;<span class="built_in">Object</span>&gt; channel =</span><br><span class="line">    BasicMessageChannel&lt;<span class="built_in">Object</span>&gt;(<span class="string">&#x27;dev.flutter.pigeon.NativeRouterApi.pushNativeRoute&#x27;</span>, StandardMessageCodec());</span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">Map</span>&lt;<span class="built_in">Object</span>, <span class="built_in">Object</span>&gt; replyMap = <span class="keyword">await</span> channel.send(encoded) <span class="keyword">as</span> <span class="built_in">Map</span>&lt;<span class="built_in">Object</span>, <span class="built_in">Object</span>&gt;;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>**Native to Native **</p>
<p>当前项目采用Arouter路由跳转，可继续使用，不再分析</p>
</li>
</ol>

        </section>
        <hr/>
        <nav class="pagination" style="width:auto" role="pagination">
            
            <a data-pjax class="newer-posts" href="/2021/05/09/Flutter总结/">← Prev Post</a>
            
            <a class="share-button" data-original-title title>Share this Post</a>
            
            <a data-pjax class="older-posts" href="/2021/04/13/Gradle_Plugin_Shrink_Image/">Next Post →</a>
            
        </nav>
        <br/>
        <br/>
        <section id="comment">
            <div id="comment-box"></div>
        </section>


    </article>
</main>


  
<footer class="site-footer">
    
    <div class="inner">
        <section class="copyright"><a href="/"></a> &copy; Paofan&Orange 2014</section>
        <section class="poweredby">Published with <a target="_blank" href="http://hexo.io/">Hexo   </a> and Theme by <a target="_blank" href="https://github.com/yuche/hexo-theme-kael">Kael</a></section>
    </div>
</footer>
</div>
</div><!-- /scroller -->

</div><!-- /pusher -->
</div><!-- /container -->
</div>

<!-- Easter eggs -->

<div class="egg animated">
    <a id="close-button" href="#">X</a>
    <div class="block">
        <div class="loading">
            <span class="ball1"></span>
            <span class="ball2"></span>
        </div>
    </div>
</div>
  
<script src="//cdn.staticfile.org/jquery/1.11.0/jquery.min.js"></script>
<script>
    if (!window.jQuery) {
        var script = document.createElement('script');
        script.src = "/js/jquery.min.js";
        document.body.appendChild(script);
    }
</script>
<script type="text/javascript" src="/js/lib.js"></script>
<script type="text/javascript" src="/js/main.js"></script>







</body>
</html>
